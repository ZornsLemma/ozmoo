digraph subroutines {
    graph [nodesep=1, label="Ozmoo virtual memory subroutines", fontsize=20, labelloc=t];
    node [shape=rectangle, style=rounded];

    # string_array_read_byte -> read_byte_at_z_address;
    # parse_array_read_byte -> read_byte_at_z_address;

    subgraph cluster_mempointer {
	label = "z_address (Z-machine)\lmempointer (6502)\l";
	labeljust="l";
	style=dashed;
	{ rank=same; set_z_address -> read_next_byte [label="controls", style=dotted] };
	read_next_byte -> read_byte_at_z_address [label="(hot)"];
    }

    subgraph cluster_z_pc_mempointer {
	label = "z_pc (Z-machine)\lz_pc_mempointer (6502)\l";
	labeljust="l";
	style=dashed
	{ rank=same; set_z_pc -> read_next_byte_at_z_pc [label="controls", style=dotted] };
	set_z_pc -> get_page_at_z_pc;
	read_next_byte_at_z_pc -> inc_z_pc_page;
	inc_z_pc_page -> get_page_at_z_pc;
    }

    get_page_at_z_pc -> read_byte_at_z_address;
}

# TODO: Check these in code before adding, but looking at an old paper version I found, it may be worth adding:
# - z_init and restore_game calling get_page_at_z_pc
# - z_ins_copy_table (Z5+) calling read_byte_at_z_address
# - read_byte_at_z_address 'owns' zp_pc_[hl] (perhaps not on this diagram; if
#   these are not used elsewhere, they perhaps just want a mention in
#   accompanying text noting they are an internal detail, mainly because their
#   names are similar to other variables which aren't internal)

# vi: sw=4 sts=4
